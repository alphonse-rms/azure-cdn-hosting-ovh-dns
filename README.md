# Static website hosting using Azure SA, Azure CDN and OVH DNS

## Requirements

### OVH CREDENTIALS

Generate your API keys: https://api.ovh.com/createToken/?GET=/*&POST=/*&PUT=/*&DELETE=/*

### Azure CLI

Install Azure CLI from this link: https://docs.microsoft.com/fr-fr/cli/azure/install-azure-cli

<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->

## Usage

```hcl
provider "azurerm" {
  features {
    key_vault {
      purge_soft_delete_on_destroy    = false
      recover_soft_deleted_key_vaults = true
    }
  }
}

provider "ovh" {
  endpoint = "ovh-eu"
}

module "azure_static_website_with_ovh_dns" {
  source = "../../"

  location                      = var.location
  app_name                      = var.app_name
  resource_group_name           = var.resource_group_name
  domain                        = var.domain
  subdomain                     = var.subdomain
  alternatives_domains          = var.alternatives_domains
  cdn_location                  = var.cdn_location
  cdn_public_html_path          = "${path.cwd}/${var.cdn_public_html_path}"
  cdn_reroute_all_rules         = var.cdn_reroute_all_rules
  cdn_enable_compression        = var.cdn_enable_compression
  cdn_content_types_to_compress = var.cdn_content_types_to_compress
  tags                          = var.tags
}

```

## Inputs

| Name                                                                                                                     | Description                                                                                                    | Type           | Default                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Required |
| ------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------- | -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------: |
| <a name="input_alternatives_domains"></a> [alternatives_domains](#input_alternatives_domains)                            | List of others subdomains which the certificate will match                                                     | `list(any)`    | `[]`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |    no    |
| <a name="input_app_name"></a> [app_name](#input_app_name)                                                                | The name of the hosted app for resource naming purpose                                                         | `string`       | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |   yes    |
| <a name="input_cdn_content_types_to_compress"></a> [cdn_content_types_to_compress](#input_cdn_content_types_to_compress) | List of content types to compress                                                                              | `list(string)` | <pre>[<br> "text/html",<br> "text/css",<br> "text/plain",<br> "text/xml",<br> "text/x-component",<br> "text/javascript",<br> "application/x-javascript",<br> "application/javascript",<br> "application/json",<br> "application/manifest+json",<br> "application/vnd.api+json",<br> "application/xml",<br> "application/xhtml+xml",<br> "application/rss+xml",<br> "application/atom+xml",<br> "application/vnd.ms-fontobject",<br> "application/x-font-ttf",<br> "application/x-font-opentype",<br> "application/x-font-truetype",<br> "image/svg+xml",<br> "image/x-icon",<br> "image/vnd.microsoft.icon",<br> "font/ttf",<br> "font/eot",<br> "font/otf",<br> "font/opentype"<br>]</pre> |    no    |
| <a name="input_cdn_enable_compression"></a> [cdn_enable_compression](#input_cdn_enable_compression)                      | Sets whether to enable compression in order to reduce bandwidth usage                                          | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |    no    |
| <a name="input_cdn_location"></a> [cdn_location](#input_cdn_location)                                                    | Azure region where the CDN will be created                                                                     | `string`       | `"westeurope"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_cdn_public_html_path"></a> [cdn_public_html_path](#input_cdn_public_html_path)                            | Static web hosting root directory without the trailing slash                                                   | `string`       | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |   yes    |
| <a name="input_cdn_reroute_all_rules"></a> [cdn_reroute_all_rules](#input_cdn_reroute_all_rules)                         | Additional rewrite rules for CDN endpoint, usually used with react apps                                        | `any`          | `{}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |    no    |
| <a name="input_domain"></a> [domain](#input_domain)                                                                      | domain for the CDN custom endpoint                                                                             | `string`       | `"contoso.com"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |    no    |
| <a name="input_index_document"></a> [index_document](#input_index_document)                                              | The name of the document (html) file to be used as index                                                       | `string`       | `"index.html"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_location"></a> [location](#input_location)                                                                | Azure region where the resource group is located                                                               | `string`       | `"france central"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |    no    |
| <a name="input_resource_group_name"></a> [resource_group_name](#input_resource_group_name)                               | Ressource group where the ressources will be created                                                           | `string`       | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |   yes    |
| <a name="input_storage_account_ip_whitelist"></a> [storage_account_ip_whitelist](#input_storage_account_ip_whitelist)    | List of public IP or IP ranges in CIDR Format. Only IPV4 addresses are allowed. /31 and /32 CIDR not supported | `list(string)` | `[]`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |    no    |
| <a name="input_storage_account_settings"></a> [storage_account_settings](#input_storage_account_settings)                | Map of settings for the storage account                                                                        | `map(string)`  | <pre>{<br> "account_kind": "StorageV2",<br> "account_replication_type": "LRS",<br> "account_tier": "Standard"<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |    no    |
| <a name="input_subdomain"></a> [subdomain](#input_subdomain)                                                             | Sub domain for the CDN custom endpoint                                                                         | `string`       | `"blog"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |    no    |
| <a name="input_tags"></a> [tags](#input_tags)                                                                            | Map of tags for resources                                                                                      | `map(string)`  | <pre>{<br> "environment": "test"<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |    no    |

## Outputs

| Name                                                                                                                             | Description                              |
| -------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------- |
| <a name="output_customdomainname"></a> [customdomainname](#output_customdomainname)                                              | List of URL(s) binded to CDN             |
| <a name="output_static_website_cdn_endpoint_url"></a> [static_website_cdn_endpoint_url](#output_static_website_cdn_endpoint_url) | CDN endpoint URL for Static website      |
| <a name="output_static_website_url"></a> [static_website_url](#output_static_website_url)                                        | static web site URL from storage account |

<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
